# Box Table

Box Table 是一個響應式的web手機應用，使用SvelteKit構建，專為手機用戶設計，提供直觀的表格操作體驗。

## 功能

- 響應式設計，適配各種手機螢幕
- 特殊用途的表單：1~49號碼排列與互動
  - 新增一列（橫向）包含1~49個正方體box，數字順序排列
  - 設定起始數字（1~49），從該數字開始循環排列至49個box
  - 設定後不可修改，只能刪除整列並重新新增
  - 每個box可點擊切換顏色（白底黑字 ↔ 黑底白字）
- 圖形互動，使用svelte-konva實現互動式圖形元素
- 適合手機畫面，支援無限列增加與xy滾動

## 需求規格

### 1. 新增列功能

- 用戶可以新增一列（橫向排列）box
- 每列包含49個正方體box
- box內顯示1~49的數字，順序排列｀
- 每列建立後內容不可再修改，只能刪除整列重新新增
- 最多允許存在1000列，超過應提示使用者

### 2. 起始數字設定

- 每次新增列時，用戶需設定起始數字（1~49）
- 排列邏輯：
  - 從設定數字開始（如13）
  - 依次增加：13, 14, 15, ..., 49
  - 49後重複：1, 2, 3, ..., 直到填滿49個box
- 設定後不可修改

### 3. 刪除列功能

- 每列提供刪除按鈕
- 刪除整列後可重新新增

### 4. Box互動

- 預設：白底黑字
- 點擊：切換為黑底白字
- 再點擊：復原白底黑字
- 循環切換

### 5. 顯示與滾動

- box大小適合手機畫面（建議40x40px）
- 橫向49個box，豎向無限列
- 支援xy軸滾動
- 支援縮放功能（pinch to zoom）

## 技術實作細節

### 資料持久化
- 使用 `localStorage` 儲存所有列資料
- 儲存內容包括：
  - 每列的起始數字
  - 每個box的顏色狀態（白底黑字/黑底白字）
- 頁面載入時自動恢復資料

### UI/UX 設計

#### 新增列介面
- 位置：頁面頂部
- 流程：
  1. 點擊頂部「新增列」按鈕
  2. 彈出浮動視窗輸入起始數字（1~49）
  3. 驗證輸入後建立新列
  4. 新列出現在最左方

#### 刪除列
- 刪除按鈕位於每列右側
- 刪除前需要確認對話框（防止誤刪）

#### 列識別
- 每列顯示列編號/ID
- 設計需避免與box數字混淆
- 位置：每列最左側

### 渲染策略

#### Canvas 實作
- 使用 `svelte-konva` (Konva.js 的 Svelte 包裝)
- 原因：避免 HTML 方式產生 49,000+ DOM 元素（1000列 × 49個box）造成效能問題
- 組件架構：
  - `Stage`：主要 canvas 容器
  - `Layer`：列容器
  - `Rect`：個別 box
  - `Text`：box 內的數字

#### 效能優化
- **虛擬滾動**：只渲染可見範圍的列
  - 僅渲染視窗內 + 緩衝區的列
  - 根據滾動位置動態建立/銷毀 Konva layers
  - 目標：任何時刻保持渲染元素在 500-1000 個以內
- **事件委派**：有效使用 Konva 事件系統
- **狀態管理**：最小化反應式更新

### 手機優化

#### 縮放與平移
- **捏合縮放**：支援手機縮放功能
- **平移**：支援雙軸觸控平移
- **Konva 功能**：使用 Konva 內建的 `draggable` 和 `scale` 屬性

#### 響應式尺寸
- **Box 尺寸**：40x40px 基準
- **總寬度**：49個box × 40px = 1960px（需要橫向滾動）
- **縮放範圍**：建議 0.5x - 2x

### 詳細設計規格

#### Box 樣式
- **間距**：完全無間距，box之間緊密對齊（0px gap）
- **邊框**：無邊框
- **對齊**：所有box必須精確對齊，無縫隙
- **顏色**：
  - 預設：白底黑字 (`background: white; color: black`)
  - 點擊後：黑底白字 (`background: black; color: white`)

#### 起始數字選擇器
- **類型**：網格選擇器 (Grid Picker)
- **佈局**：7x7 網格顯示數字 1-49
- **互動**：點擊任一數字即選定
- **必選**：使用者必須選擇一個數字才能建立列

#### 列編號設計
- **格式**：#1, #2, #3...
- **顏色**：灰色系（如 `#666` 或 `#888`），與box數字區分
- **位置**：每列最左側
- **字體**：比box數字稍小

#### 刪除按鈕
- **樣式**：文字按鈕「刪除」
- **位置**：每列右側
- **確認對話框**：「確定要刪除列 #X 嗎？此操作無法復原。」
  - 按鈕：「確定刪除」/「取消」

#### Stage 尺寸
- **高度**：滿版 (`100vh` 扣除頂部「新增列」按鈕高度)
- **寬度**：100vw (響應式)
- **滾動容器**：外層 HTML `<div>` 處理滾動，內層 Konva Stage 渲染內容

#### 資料結構 (localStorage)
```typescript
{
  rows: [
    {
      id: number,           // 列ID
      startNumber: number,  // 起始數字 (1-49)
      boxes: boolean[]      // 49個boolean，true=黑底白字，false=白底黑字
    }
  ]
}
```

#### 限制與驗證
- **最大列數**：1000列
- **超過限制**：顯示提示「已達到最多1000列的上限」
- **新增按鈕**：達到上限時停用 (disabled)
